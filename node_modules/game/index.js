/*	module.exports contains all of the functions that are to be exported
	This file is to store game states, game functions eg.
	This keeps the networking (socket) stuff and the game logic seperate
*/

function room(id){
	console.log("Creating new room, id = %s", id);
	// These values are all default values, they can be changed by the client

	this.id = id;
	this.bd 				= {x:300, y:300};	// Different from Client's bd, this only includes cell dimensions
	this.liveCondition 		= [2,3]
	this.reproCondition 	= [3];
	this.userList			= [];
	this.simulation			= false;
	this.random 			= false;
	this.state 				= createState(this.bd.x, this.bd.y);
}

// This will initiate a new user with state and id
room.prototype.addUser = function(id){
	this.userList.push(id);
	console.log("User Added! id = %s to room id = %s", id, this.id);
}

// This will remove a user's id and state from the array and send state back to index.js
room.prototype.removeUser = function(id){
	delete this.userStates[id];
	console.log("User Deleted! id = %s from room id = %s", id, this.id);
}

/*	Changes state of the cell, as requested by client
	Coord is a 1d array, [xPos, yPos]
	State is true/false depending on if they are erasing or making
	id is the user id, which represents color
*/
room.prototype.changeState = function(id, coord){
	if(!coord[2]){
		this.state[coord[0]][coord[1]] = -1;
	}	
	else
		this.state[coord[0]][coord[1]] = this.userList.indexOf(id);
}

// This function creates a 2D array with dimensions width x height
function createState(width, height){
	state = new Array(width);
	for(var x = 0; x < width; x ++){
		state[x] = new Array(height);
		for(var y  = 0; y < height; y ++){
			
			/* ##Not implementing random yet##
				if(random && Math.random()>0.5)
				state[x][y] = true;
				else state[x][y] = false;
			*/
			state[x][y] = -1;
		}
	}
	return state;
}

//export main function to module
module.exports.room = room;